var urbandistancePoster;var urbandistanceWorker=(function(d){var c,f,a,e;var b=function(t,g,n,m){var u=t.length,A=[],o=0,z,x,w,s,q,D,k,y,r,p,h,B,v,l,C;while(u>0){for(z=0;z<u;z++){o+=1;if(e!==0&&o%e==0){urbandistancePoster({status:"working",at:o})}w=t[z];s=w.stationId;p=w.line;r=w.seconds;y=w.stay;C=w.walkTime;v=w.from;q=f[s];k=q.r.length;if(p!==-1&&c[s]!=d&&c[s]<=r){for(x=0;x<k;x++){D=q.r[x];if(D.s!=v&&D.l===p){h=r+D.t+y;if(c[D.s]==d||c[D.s]>h){A.push({stationId:D.s,line:D.l,stay:D.y===d?0:D.y,seconds:h,walkTime:C,from:s})}}}continue}if(c[s]!=d&&c[s]<=r){continue}c[s]=r;for(x=0;x<k;x++){D=q.r[x];if(D.s===v){continue}if(D.k!==d){l=D.k*n;if(C+l>m){continue}h=r+l;C+=l}else{if(v===-1){if(g[D.l]===d){continue}h=r+D.t}else{if(D.l===p){h=r+D.t+y}else{B=g[D.l];if(B==d){continue}if(B>0&&B<10){B=B/2}else{if(B>=10){B=B/2.3}else{B=0}}h=r+B+D.t;if(h<0){h=0}}}}A.push({stationId:D.s,line:D.l===d?-1:D.l,stay:D.y===d?0:D.y,seconds:h,walkTime:C,from:s})}}t=A;u=t.length;A=[]}return o};return function(g){c={};f=g.data["stations"];a=g.data["lines"];startPos=g.data["position"];e=g.data["reportInterval"];var l=g.data["fromStations"],p=g.data["distances"],q=g.data["maxWalkTime"],o=g.data["secondsPerKm"],h=g.data["intervalKey"],m={};for(var s in a){if(a[s][h]!=d){m[s]=a[s][h]}}var j=[];for(var i=0;i<l.length;i++){var r=p[i]*o;if(r<=q){j.push({stationId:l[i],line:-1,stay:0,seconds:r,walkTime:r,from:-1})}}var n=b(j,m,o,q);if(e!==0){urbandistancePoster({status:"working",at:n})}urbandistancePoster({status:"done",stationMap:c})}}());if(typeof(window)==="undefined"){onmessage=urbandistanceWorker;urbandistancePoster=postMessage}else{urbandistancePoster=WorkerFacade.add("media/js/worker.js",urbandistanceWorker)};